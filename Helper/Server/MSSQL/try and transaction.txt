BEGIN TRANSACTION [Tran1]

BEGIN TRY

INSERT INTO [Test].[dbo].[T1]
([Title], [AVG])
VALUES ('Tidd130', 130), ('Tidd230', 230)

UPDATE [Test].[dbo].[T1]
SET [Title] = N'az2' ,[AVG] = 1
WHERE [dbo].[T1].[Title] = N'az'

	COMMIT TRANSACTION [Tran1]

END TRY
BEGIN CATCH


 IF @@TRANCOUNT > 0
	-- Roll back complete transaction.
	ROLLBACK TRANSACTION; --ROLLBACK TRANSACTION [Tran1]
								
    -- After the rollback, echo error
    -- information to the caller.
    DECLARE @ErrorNumber INT;
    DECLARE @ErrorSeverity INT;
    DECLARE @ErrorState INT;

    SELECT @ErrorNumber = ERROR_NUMBER(); -- error ДНКФЕМ АШРЭ 13000
    SELECT @ErrorSeverity = ERROR_SEVERITY();
    SELECT @ErrorState = ERROR_STATE();

    RAISERROR (@ErrorNumber, -- Message number.
               @ErrorSeverity, -- Severity.
               @ErrorState -- State.
               )
	ХКХ ЩРН ЯННАЫЕМХЕ Я РЕЙЯРНЛ

	RAISERROR (@ErrorMessage, -- Message text.
               @ErrorSeverity, -- Severity.
               @ErrorState -- State.
               );
	RETURN;
END CATCH


ERROR_MESSAGE(), 
ERROR_LINE(), 
ERROR_PROCEDURE(), 
ERROR_STATE(),
ERROR_SEVERITY(), 
ERROR_NUMBER()


SELECT @DetailedErrorDesc =         
  CAST(ERROR_NUMBER() AS VARCHAR) + ' : '+
  CAST(ERROR_SEVERITY() AS VARCHAR) + ' : ' +
  CAST(ERROR_STATE() AS VARCHAR) + ' : ' +
  ERROR_PROCEDURE() + ' : ' +
  ERROR_MESSAGE() + ' : ' +
  CAST(ERROR_LINE() AS VARCHAR);


--one more example
CREATE PROCEDURE TRANZ
AS BEGIN
	BEGIN TRANSACTION
		INSERT янрпсдмхйх (TAB) VALUES (11)
		INSERT вюяш (TAB) VALUES (11)
	GO
	--еякх асдер лмнцн бярюбнй хкх дпсцху деиярбхи, х он осрх й @@ERROR опнхгнидер ньхайю,
	сякнбхе IF опносярхряъ, дкъ мнплюкэмнцн нрйюрю бяеу дюммшу менаундхлн ярюбхрэ GO
	IF @@ERROR = 0
	COMMIT
	ELSE
	ROLLBACK
END